{% extends 'base.html' %}

{% load static %}

{% load humanize %}

{% block title %}Order{% endblock %}

{% block content %}

<div class="container-fluid bg-light py-3">

  <div class="row">

    {% if order_items %}
      <div class="col-8 pr-0">
    {% else %}
      <div class="col pr-0">
    {% endif %}

      <div class="container-fluid p-0">
        <p>DISHES</p>
          <div class="row m-0 p-0">
              {% for item in active_items %}
                <div class="col-lg-4 col-md-6 col-12 mb-3 m-0 p-0">
                  <div class="card mr-3 border rounded shadow-sm">
                    <img src="{% static 'webplatform/'|add:item.name|add:'.png' %}" class="card-img-top" alt="...">
                    <div class="card-body p-3">
                      <h5 class="card-title">{{ item.name }}</h5>
                      <p class="card-text">{{ item.description }}</p>
                      <p class="card-text">${{ item.price|floatformat:2|intcomma }} <small>/ portion</small></p>
                      <p class="card-text"><small>{% if item.calories %}Calories: {{ item.calories }} kcal/portion &emsp; {% endif %}{% comment %}{% if item.protein %}Protein: {{ item.protein }} g &emsp; {% endif %}{% if item.fat %}Fat: {{ item.fat }} g &emsp; {% endif %}{% if item.carbs %}Carbs: {{ item.carbs }} g{% endif %}{% endcomment %}</small></p>
                      <p class="card-text"><small>
                        Minimum {{ item.minimum_portions }} {% if item.minimum_portions > 1 %}portions{% else %}portion{% endif %}
                        {% if item.portion_increment > 1 %} | Portions in multiples of {{ item.portion_increment }}{% endif %}
                      </small></p>
                      <p class="card-text"><small>Order at least {{ item.minimum_lead_time }} {% if item.minimum_lead_time > 1 %}days{% else %}day{% endif %} in advance</small></p>
                      {% if user.is_authenticated %}
                        <a href="{{ item.get_add_to_order_url }}" class="btn btn-primary btn-block">Add to order</a>
                      {% else %}
                        <a href="{% url 'login' %}?next={% url 'webplatform:order_items_view' %}" class="btn btn-primary btn-block">Add to order</a>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
          </div>
      </div>

    </div>

    {% if order_items %}

      <div class="col-4 mt-4 pt-3">
        <div class="sticky-top">
          <h5>
            Your order
            {% if messages %}
              {% for message in messages %}
                <span class="badge badge-success message">{{ message }}</span>
              {% endfor %}
            {% endif %}
          </h5>
          <div class="container">
            {% for order_item in order_items %}
              <div class="row py-2">
                <div class="col-xl-6 text-xl-left px-0">
                  {{ order_item.item.name }} <small class="mr-3">${{ order_item.item.price|floatformat:2|intcomma }}</small>
                </div>
                <div class="col-xl-3 text-xl-center px-0">
                  <a href="{{ order_item.item.get_remove_from_order_url }}"><i class="fas fa-minus"></i></a>
                  <span class="badge badge-secondary">{{ order_item.quantity }}</span>
                  <a href="{{ order_item.item.get_add_to_order_url }}"><i class="fas fa-plus"></i></a>
                </div>
                <div class="col-xl-3 text-xl-right px-0">
                  ${{ order_item.get_total_item_price|floatformat:2|intcomma }}
                </div>
              </div>
            {% endfor %}
          </div>
          <div class="container">
            <div class="row border-top py-2 mb-2">
              <div class="col text-xl-right px-0">
                {% if user.is_authenticated and free_delivery or not user.is_authenticated %}
                  <s class="text-secondary">Delivery: $7.00</s>
                  <p><small>Free delivery with first order</small></p>
                {% else %}
                  <p>Delivery: $7.00</p>
                {% endif %}
                <hr>
                ${{ order.get_total_order_price|floatformat:2|intcomma }}
              </div>
            </div>
          </div>
          <a href="{% url 'webplatform:order_timing_view' %}" class="btn btn-attention btn-block">Checkout</a>
        </div>
      </div>

    {% endif %}

  </div>

</div>

{% endblock %}
